{% extends "base.html" %}

{% block title%}{{title}}{% endblock %}


{% block content %}

    <script src="https://libs.cartocdn.com/carto-vl/v1.2.4/carto-vl.min.js"></script>
    <!-- Load Mapbox GL -->
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.js"></script>
    <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.css" rel="stylesheet">
	<style>
	  #map {
		width: 80%;
        height: 80%;
        position: absolute;
	  }
      #legend {
        position: fixed;
        right: 2em;
        bottom: 2em;
      }
	</style>

    <!-- Your map will go here -->
	<div class="container">
	  <div>{{ readme | safe }}</div>
      <div id="map"></div>
      <div id="legend" >{{ legend | safe }}</div>
    </div> 

<script>
  const config = {{ config | safe }}
  const map = new mapboxgl.Map(config.map)

  carto.setDefaultAuth({
    username: 'paulwalker-datopian',
    apiKey: 'default_public'
  })

  config.layers.forEach(l => {
    const source = new carto.source.Dataset(l.source)
    console.log(l.viz)
    const v = Object.assign({}, l.viz, {resolution:100})
    const viz = new carto.Viz(l.viz)
    const layer = new carto.Layer('layer', source, viz)
    const interactivity = new carto.Interactivity(layer);
    
    interactivity.on('featureHover', e => {
      e.features.forEach(f => {
        console.log(f.variables.streetname.value)
      })
    });

    layer.addTo(map)
  })
</script>

{% endblock %}

<!-- wax footer -->
{% block footer %}{% endblock %}
